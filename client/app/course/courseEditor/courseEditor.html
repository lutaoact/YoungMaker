<form class="course-editor" name="form" ng-submit="submitCourse(form)" novalidate>
  <div class="container">
    <div class="col-lg-10 col-lg-offset-1 col-md-8 col-md-offset-2">
      <div class="panel panel-card clearfix" style="margin-bottom:-1px;">
        <div class="panel-headding text-center">
          创建趣课
        </div>
        <div class="row">
          <div class="course-summary col-lg-10 col-lg-offset-1">
            <div class="image-upload">
              <uploader
                class="cover-uploder"
                limit="{{configs.imageSizeLimitation}}"
                on-complete="onCoverUploaded($data)"
                accept-type="image"
                crop="true"
                style="height: 210px;width: 290px;margin-bottom:20px"
                crop-ratio="1.33"
                max-width="600">
                <div class="cover" ng-if="course.image" ng-src="{{course.image}}" source-attr="background-image">
                  <div class="mask">
                    <div class="btn btn-xs btn-primary">
                      <i class="fa fa-cloud-upload"></i>
                      修改图片
                    </div>
                  </div>
                </div>
                <div class="drag-uploder" ng-if="!course.image" style="padding: 30px 16px;">
                  <img src="/assets/images/empty.png" alt="">
                  <h4>封面照片</h4>
                  <div class="text-muted">请拖拽图片至此或点击上传按钮</div>
                  <div class="btn btn-xs btn-primary">
                    <i class="fa fa-cloud-upload"></i>
                    上传图片
                  </div>
                </div>
              </uploader>
            </div>
            <div class="form-group">
              <label class="col-md-3" for="title">趣课名称</label>
              <div class="col-md-9">
                <input type="text"
                  name="title"
                  id="title"
                  ng-maxlength="20"
                  required
                  ng-model="course.title"
                  class="form-control input-md">
                <p class="text-danger" ng-show="form.title.$error.required && submitted">
                  请输入趣课名称
                </p>
                <p class="text-danger" ng-show="form.title.$error.maxlength && submitted">
                  趣课名称不能超过20个字
                </p>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3" for="category">趣课分类</label>
              <div class="col-md-3">
                <select ng-model="course.categoryId"
                  id="category"
                  required
                  name="category"
                  ng-options="category.name for category in categories track by category._id"
                  class="form-control input-md">
                </select>
                <p class="text-danger" ng-show="form.category.$error.required && submitted">
                  请输入趣课名称
                </p>
              </div>
            </div>
            <div class="form-group">
              <label class="col-md-3" for="info">趣课简介</label>
              <div class="col-md-9">
                <input type="text" placeholder="请输入趣课简介。。。" required id="info" name="info" ng-model="course.info" class="form-control input-md">
                <p class="text-danger" ng-show="form.info.$error.required && submitted">
                  请输入趣课简介
                </p>
                <p class="text-danger" ng-show="form.info.$error.maxlength && submitted">
                  趣课简介不能超过20个字
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="place" fix-when-reach-top offset="580">
  </div>
  <div class="tool-bar" ng-show="!viewState.showPreview" fix-when-reach-top offset="580" style="margin-bottom:-2px;">
    <div class="container">
      <div class="col-lg-10 col-lg-offset-1 col-md-8 col-md-offset-2">
        <div class="panel panel-card clearfix" style="margin-bottom:-1px;">
          <div class="col-lg-10 col-lg-offset-1">
            <div class="row">
              <div class="col-md-6 tools">
                <a class="btn btn-xs btn-primary btn-outline">步骤</a>
                <span dropdown style="position: relative">
                  <a href="" class="btn btn-xs btn-primary btn-outline">
                    <span ng-click="addStep(viewState.lastPlugin)">{{viewState.lastPlugin.text}}</span>
                    <i class="fa fa-chevron-down" dropdown-toggle></i>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li ng-repeat="plugin in plugins">
                      <a href="" ng-click="addStep(plugin)">
                        {{plugin.text}}
                      </a>
                    </li>
                  </ul>
                </span>
              </div>
              <div class="col-md-6 actions">
                <a class="btn btn-xs btn-primary btn-outline" ng-click="viewState.showPreview=true">预览</a>
                <button class="btn btn-xs btn-primary btn-outline" type="submit">保存</button>
                <a class="btn btn-xs btn-primary btn-outline">发布</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="col-lg-10 col-lg-offset-1 col-md-8 col-md-offset-2">
      <div class="panel panel-card clearfix">
        <div class="row">
          <div class="course-body col-lg-10 col-lg-offset-1 clearfix">
            <div class="editor clearfix" ng-repeat="step in course.steps">
              <div ng-switch="step.type">
                <div ng-switch-when="wysiwyg">
                  <div class="form-group">
                    <input type="text" required title-placeholder="请输入标题" class="form-control" ng-model="step.title">
                  </div>
                  <div class="form-group">
                    <div disable-animation text-angular ng-model="step.content" placeholder="请输入内容"></div>
                  </div>
                </div>
                <div ng-switch-when="md">
                  <div class="form-group">
                    <input type="text" required title-placeholder="请输入标题" class="form-control" ng-model="step.title">
                  </div>
                  <div class="form-group">
                    <textarea name="" id="" cols="30" rows="10" class="form-control" ng-model="step.content" placeholder="请输入markdown格式的内容"></textarea>
                  </div>
                </div>
                <div ng-switch-when="embed">
                  <div class="form-group">
                    <input type="text" required title-placeholder="请输入标题" class="form-control" ng-model="step.title">
                  </div>
                  <div class="form-group">
                    <input type="text" class="form-control" title-placeholder="插入网页链接或者iframe代码" ng-model="step.content">
                  </div>
                </div>
                <div ng-switch-when="code">
                  <div class="form-group">
                    <input type="text" required title-placeholder="请输入标题" class="form-control" ng-model="step.title">
                  </div>
                  <div class="form-group">
                    <div ui-ace="aceOption" ng-model="step.content"></div>
                  </div>
                </div>
                <div ng-switch-default>
                  <div class="assets">
                  </div>
                  <div class="form-group">
                    <input type="text" required title-placeholder="请输入标题" class="form-control" ng-model="step.title">
                  </div>
                  <div class="form-group">
                    <div disable-animation text-angular ng-model="step.content" placeholder="请输入内容"></div>
                  </div>
                </div>
              </div>
              <hr>
            </div>
          </div>
        </div>
        <div class="row text-center editor-bottom">
          <button type="submit" class="btn btn-primary">保存发布</button>
          <a ng-click="cancelSave()" class="btn btn-default">取消</a>
        </div>
      </div>
    </div>
  </div>
  <div id="bottom"></div>
  <div class="preview-wrap" ng-show="viewState.showPreview" ng-click="viewState.showPreview=false">
    <div class="preview" >
      <h1>{{course.title}}</h1>
      <h2 ng-repeat-start="step in course.steps">
        {{step.title}}
      </h2>
      <div ng-switch="step.type">
        <p ng-switch-when="wysiwyg" ng-bind-html="step.content"></p>
        <div ng-switch-when="embed" compile-html="step.content|embed"></div>
        <div ng-switch-when="md" ng-bind-html="step.content|showdown"></div>
        <div ng-switch-when="code">
          <div ui-ace="aceOption" readonly ng-model="step.content"></div>
        </div>
        <p ng-switch-default ng-bind-html="step.content" ng-init="step.type='wysiwyg'"></p>
      </div>
      <hr ng-repeat-end>
    </div>
  </div>
</form>
